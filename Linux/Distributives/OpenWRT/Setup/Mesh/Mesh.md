Чем отличается бесшовный роуминг от меш.

Если хочешь, чтобы клиенты быстрее и умнее переключались между точками, включай 802.11r + 802.11k + 802.11v. Это даст максимально плавный Wi-Fi-роуминг.
Mesh - это сеть из нескольких равнозначных точек доступа, соединенных между собой по wifi. Если есть возможность сделать провод или дополнительная точка доступа только одна, то Mesh не надо.

Давай сначала разберем про быстрый роуминг. Про mesh будет ниже.

Быстрый (бесшовный) роуминг

802.11r — это роуминг, ускоряет аутентификацию при переходе между точками в одном домене. Это не значит, что клиент сам будет переключаться на лучшую точку — он просто быстрее авторизуется, если решит переключиться.
  Выбор точки доступа 802.11r не регулирует. Устройство будет держаться за свою точку, пока сигнал хоть как-то ловится, даже если рядом есть более мощная. То же с 2,4 и 5 ГГц — если слетел с 5 на 2, обратно не факт, что вернется. Чтобы это нормализовать, включаем 802.11v.

802.11k помогает клиенту собирать инфу о доступных точках и их уровне сигнала, чтобы потом выбрать лучшую. Без него устройство методом тыка ищет новые точки, а с ним уже знает, куда стоит переключаться.
  Сам по себе 802.11k не заставит устройство переключаться, но ускорит процесс выбора новой точки.
  Лучше всего работает вместе с 802.11v (он уже подсказывает, куда именно переключиться).
  Если у тебя сеть с несколькими точками и хочется, чтобы клиенты быстрее и умнее переключались между ними — включай 802.11k.

802.11v (BSS Transition Management) — это стандарт, который помогает клиентским устройствам лучше управлять подключением к точкам доступа в сети Wi-Fi. Его основная задача — улучшение и оптимизация роуминга за счет рекомендаций от точки доступа.

Про mesh

Связь точек между собой — это бэкхол. Можно сделать:

* Проводной (самый стабильный вариант). если используется проводное соединение, то у вас НЕ меш, а классическая звезда и протокол для меш маршрутизации не нужен.
* Беспроводной: WDS или 802.11s. Они примерно одинаковы по скорости, настраиваются легко, но 802.11s гибче. Если точек две: мастер и сателлит, то протокол для меш маршрутизации не нужен.
* Гибридный. Это когда часть точек доступа подключена проводом, а часть беспроводом. В такой топологии вероятно можно обойтись без протокола для меш маршрутизации не нужен

Итого, меш нужен только в случае, когда у вас больше двух роутеров соединено беспроводным образом и каждый видит каждого.

Важно: 802.11s — это не про роуминг, он просто связывает точки между собой. Сам по себе не умеет меш маршрутизацию.
Петли в сети убиваются STP. Если бэкхол одновременно и проводной, и беспроводной, сеть может зациклиться. Включаем STP на br-lan (в Luci есть галочка). Без него можно словить сетевой шторм — сначала 500 Мбит/с, потом резко тормоза и 20 Мбит/с.

Маршрутизация в mesh-сетях обеспечивается специальными протоколами маршрутизации, такими как olsr, batman. Еще упоминается пакет mesh11sd, который должен настраивать параметры автоматически, но он конфликтует c LUCI и при установке деактивирует его. Не подготовленным пользователям рекомендую не пробовать ставить mesh11sd и olsr. 
Пробуем Batman (он просто ставится и хорошо справляется с задачей). 

Итог: 
1. 802.11r ускоряет аутентификацию, 802.11v помогает клиенту выбирать точку. Настройка бесшовного wifi (https://t.me/itdogchat/44512/253614)

____________
Включение быстрого роуминга (бесшовный вайфай)

📌 Настройка OpenWRT
📍 Сеть → Беспроводные сети → Выбрать свою сеть (SSID) → Редактировать
➡️ Вкладка WLAN роуминг. Ставим  все галки. Вот краткое описание их смысла: 


 ✅ Включить 802.11r (Быстрый роуминг)
 Ускоряем повторную аутентификацию при смене точки доступа
 NAS ID: любое уникальное название (например, wifi-router)
 Мобильный домен: по умолчанию 4f57, менять не нужно, если у всех точек он одинаковый

 ✅ Включить "Продвигать PMK R1" 
точки будут делиться ключами - как раз это и ускоряет повторную аутентификацию

 ✅ Включить 802.11k (Neighbor Reports)
 ✅ Включить "Отчет о соседях" и "Отчет о маяках"
Помогаем клиентам быстрее находить ближайшие точки доступа

✅  Включить 802.11v (BSS Transition) – точки помогут устройствам быстрее переключаться и учитывать их загруженность
Оптимизируем выбор точки и балансируем нагрузку

✅ 802.11v: Proxy ARP. 
Устройства не будут часто "просыпаться" для ответа на ARP-запросы, что помогает сэкономить энергию и уменьшить нагрузку на сеть.

📌 Если клиенты медленно переключаются с одной точки на другую, то придется настроить параметры для более агрессивного управления роумингом. Для управления этими параметрами ставим и настраиваем пакет DAWN https://t.me/itdogchat/44512/254202
____________

2. 802.11s связывает точки. Настройка mesh (https://t.me/itdogchat/44512/254297)

__________________
Настройка mesh (802.11s)

Точка, которая подключена к интернету называется мастер, все остальные - сателлиты. 
Если у вас всего один сателлит и вы хотите просто расширить зону покрытия wifi, то вам подходит mesh (802.11s) без протокола маршрутизации. По сути это будет не mesh, а замена проводного соединения между роутерами и топология звезда.

Первым делом надо отключить DHCP на сателлитах и назначить им статический IP:
Отключить DHCP на сателлите: Сеть → Интерфейсы → LAN → DHCP-сервер → Игнорировать интерфейс.
Настроить статический IP: Сеть → Интерфейсы → LAN → Установить статический IP (например, 192.168.1.2). Указать шлюз: 192.168.1.1, DNS: 192.168.1.1.

📍 Связываем точки в Mesh (беспроводной бэкхол)

Сеть → Беспроводные сети → Добавить новое соединение
Режим: Mesh (802.11s)
SSID: одно и то же на всех точках
Network: добавляем интерфейс lan (по умолчанию пусто!)
Ключ: WPA3-SAE (одинаковый на всех точках)

Если у вас больше одного сателлита и они видят каждый каждого, то будем ставить протокол маршрутизации в меш сетях Batman: https://t.me/itdogchat/44512/253497
__________________


3. Batman рулит маршрутизацией. Настройка Batman (https://t.me/itdogchat/44512/253497)(not exist)


DAWN рулит бесшовным вайфаем. Настройка DAWN

__________________
4. Настройка DAWN

Тонкая настройка роуминга. Которую мы настроили тут. Если клиенты "залипают" на точках доступа, то придется ставить и настраивать пакет DAWN, который управляет параметрами роуминга (802.11r/k/v). 

💡Это краткая выжимка из документации(https://github.com/berlin-open-wireless-lab/DAWN/blob/master/CONFIGURE.md).

ставим пакет luci-app-dawn

Обязательно меняем:

Network (Общие настройки)
Broadcast IP: 192.168.1.255
Global Metric: DURATION = 150 (по умолчанию "0" — рассылка анонсов отключена)

Остальных параметров очень много, но по умолчанию они сбалансированы. Если хочется более агрессивного управления, можно изменить только эти:

Настройки 5 ГГц
(Если разделяете SSID и используете только 5 ГГц, 2.4 можно пропустить.)

Меняем три параметра:  Low RSSI Value-RSSI Center-RSSI Value. (Они отличаются друг от друга на равное значение. Я меняю центр и делаю плюс-минус 10 от центра). 
📍 Если сеть разреженная (AP далеко друг от друга), можно оставить RSSI Center = -70. (По-умолчанию)
📍 Если сеть очень плотная (много AP на небольшом расстоянии), стоит уменьшить RSSI Center до -60

Начать эксперименты можно с таких параметров:
RSSI Center: -65 (или -60, если высокая плотность точек) (по умолчанию -70)
RSSI Value: -55 (чтобы стимулировать подключение к более мощным AP) (по умолчанию -60)
Low RSSI Value: -75 (чтобы клиент раньше отказывался от слабых точек) (по умолчанию -80)
RSSI Weight = 1  (По умолчанию 0 и это значит, что механизм оценки вообще выключен). Если клиенты "залипают" на точках и не хотят переключаться → увеличиваем rssi_weight от 1 до 5)

Если поставили агрессивные параметры RSSI Center, но клиенты продолжают "тупить", то тюним тайминги:
Times
Connection Timeout (время ожидания до того, как соединение считается отключенным) по умолчанию: 60 секунд. Пробуем для начала 10. Если помогло, то оставляем 30-40. 
Это ускорит процесс признания "потерянных" соединений, что поможет системе быстрее реагировать на изменения состояния клиентов.
remove_client — это время, через которое данные о клиенте удаляются из списка активных клиентов. Значение по умолчанию — 15 секунд. Пробуем ставить 5.

🛠 Важно: Конфигурация должна быть одинаковой на всех точках доступа!

__________________


Надо ставить mpad full